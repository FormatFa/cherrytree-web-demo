(function(e){function t(t){for(var n,i,c=t[0],s=t[1],u=t[2],h=0,f=[];h<c.length;h++)i=c[h],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,c=1;c<r.length;c++){var s=r[c];0!==a[s]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},o=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4b6a":function(e,t,r){"use strict";r("c4c9")},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},a9a1:function(e,t,r){},c4c9:function(e,t,r){},cd49:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-navigation-drawer",{ref:"drawer",attrs:{app:"",clipped:!0,"hide-overlay":!1},model:{value:e.showNav,callback:function(t){e.showNav=t},expression:"showNav"}},[r("v-treeview",{attrs:{activatable:"","open-on-click":!1,items:e.getCurrentNavTree},on:{"update:active":e.onClickNav}}),r("v-switch",{staticClass:"ml-3",attrs:{label:"vConsole: "+e.isShowDebug.toString()},on:{change:e.onDebugSwitch},model:{value:e.isShowDebug,callback:function(t){e.isShowDebug=t},expression:"isShowDebug"}})],1),r("v-app-bar",{attrs:{"clipped-left":!0,app:"",color:"primary",dark:""}},[r("v-app-bar-nav-icon",{on:{click:function(t){t.stopPropagation(),e.showNav=!e.showNav}}}),r("v-spacer"),r("v-file-input",{staticClass:"mt-4",attrs:{placeholder:"upload local ctb file","hide-input":!1,hint:"upload a ctb file","truncate-length":"15"},on:{change:e.onUploadFile}}),r("v-divider",{attrs:{vertical:""}}),r("v-btn",{attrs:{icon:""},on:{click:function(t){e.isShowInputDialog=!0}}},[r("v-icon",{staticClass:"ml-2"},[e._v("mdi-cloud-download")])],1)],1),r("v-main",[r("v-overlay",{attrs:{value:e.isLoading}},[r("v-progress-circular",{staticClass:"ma-auto",attrs:{indeterminate:"",color:"primary"}})],1),r("CherryReader",{attrs:{xmlContent:e.txt,cherrytree:e.cherrytree}}),r("v-dialog",{model:{value:e.isShowInputDialog,callback:function(t){e.isShowInputDialog=t},expression:"isShowInputDialog"}},[r("v-card",[r("v-card-text",[r("v-text-field",{attrs:{label:"load from url",hint:"ctb file url",required:""},model:{value:e.remoteUrl,callback:function(t){e.remoteUrl=t},expression:"remoteUrl"}})],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.isShowInputDialog=!1}}},[e._v(" Close ")]),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.loadFromUrl}},[e._v(" Load ")])],1)],1)],1)],1),r("v-snackbar",{model:{value:e.isShowErrorMsg,callback:function(t){e.isShowErrorMsg=t},expression:"isShowErrorMsg"}},[e._v(" "+e._s(e.errorMsg)+" ")])],1)},o=[],i=r("b85c"),c=r("1da1"),s=(r("96cf"),r("8a79"),r("b0c0"),r("d3b7"),r("5cc6"),r("907a"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"reader mx-sm-auto ma-8"},e._l(e.getRichTextList,(function(e){return r("rich-text",{key:e.offset,attrs:{content:e.content,attributes:e.attributes}})})),1)}),u=[],l=r("d4ec"),h=r("bee2"),f=r("262e"),d=r("2caf"),p=r("9ab4"),v=r("1b40"),b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"text-body-1 paragraph"},[e._v(e._s(e.content))])},g=[],w=n["a"].extend({name:"RichText",props:{content:{type:String},attributes:{type:Object}}}),y=w,m=(r("4b6a"),r("2877")),x=Object(m["a"])(y,b,g,!1,null,"79d9a3ff",null),_=x.exports,O=function(e){Object(f["a"])(r,e);var t=Object(d["a"])(r);function r(){var e;return Object(l["a"])(this,r),e=t.apply(this,arguments),e.showNav=!0,e.xmlParser=new DOMParser,e}return Object(h["a"])(r,[{key:"getRichTextList",get:function(){if(console.log("try parse node.."),null==this.xmlContent)return[];var e,t=this.xmlParser.parseFromString(this.xmlContent,"application/xml"),r=[],n=t.getElementsByTagName("rich_text"),a=0,o=Object(i["a"])(n);try{for(o.s();!(e=o.n()).done;){var c,s=e.value,u={},l=Object(i["a"])(s.attributes);try{for(l.s();!(c=l.n()).done;){var h=c.value;null!=h.nodeValue&&(u[h.name]=h.nodeValue)}}catch(f){l.e(f)}finally{l.f()}r.push({offset:a++,content:s.innerHTML,attributes:u})}}catch(f){o.e(f)}finally{o.f()}return r}}]),r}(v["c"]);Object(p["a"])([Object(v["b"])({type:String})],O.prototype,"xmlContent",void 0),O=Object(p["a"])([Object(v["a"])({components:{RichText:_}})],O);var k=O,j=k,S=(r("f498"),Object(m["a"])(j,s,u,!1,null,"6987169e",null)),C=S.exports,N=function(){function e(){Object(l["a"])(this,e),this.nodeTree=[]}return Object(h["a"])(e,[{key:"init",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.cherrytreeDao=t,e.next=3,this.cherrytreeDao.loadAllNodeTree();case 3:this.nodeTree=e.sent;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getNodeTxtById",value:function(e){if(void 0==this.cherrytreeDao)throw Error("dao is null,please init first!");return this.cherrytreeDao.getNodeTextById(e)}},{key:"getNodes",value:function(){return this.nodeTree}}]),e}(),T=(r("4ec9"),r("3ca3"),r("ddb0"),r("159b"),r("fdac4")),D=r.n(T),V=function(){function e(){Object(l["a"])(this,e)}return Object(h["a"])(e,null,[{key:"initSql",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D()({locateFile:function(e){return"/".concat(e)}});case 2:this.sql=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initSql2",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D()();case 2:this.sql=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSQL",value:function(){return this.sql,this.sql}}]),e}(),M=function(){function e(t,r,n,a,o,i,c,s,u,h,f){Object(l["a"])(this,e),this.children=[],this.node_id=t,this.father_id=r,this.name=n,this.syntax=a,this.is_richtxt=o,this.has_codebox=i,this.has_table=c,this.has_image=s,this.level=u,this.ts_creation=h,this.ts_lastsave=f}return Object(h["a"])(e,[{key:"getNodeId",value:function(){return this.node_id}},{key:"getName",value:function(){return this.name}},{key:"setChildren",value:function(e){this.children=e}},{key:"getChildren",value:function(){return this.children}},{key:"getFatherId",value:function(){return this.father_id}}]),e}(),R=function(){function e(t){Object(l["a"])(this,e),this.db=new(V.getSQL().Database)(t)}return Object(h["a"])(e,[{key:"getCodeBoxListById",value:function(e){throw new Error("Method not implemented.")}},{key:"getNodeTextById",value:function(e){var t=this.db.prepare("select txt from node where node_id=:node_id"),r=t.getAsObject({":node_id":e});return t.free(),r["txt"]}},{key:"loadAllNodeTree",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=[],r=this.db.prepare("select c.node_id,c.father_id,c.sequence,n.name,n.syntax,n.is_richtxt,n.has_codebox,n.has_table,n.has_image,n.level,n.ts_creation,n.ts_lastsave from children c left join node n on c.node_id=n.node_id;"),n=new Map;while(r.step())a=r.getAsObject(),o=a["father_id"],i=a["node_id"],c=new M(i,o,a["name"],a["syntax"],a["is_richtxt"],a["has_codebox"],a["has_table"],a["has_image"],a["level"],a["ts_creation"],a["ts_lastsave"]),n.set(i,c),0==c.getFatherId()&&t.push(c);return r.free(),n.forEach((function(e,t,r){var n=r.get(e.getFatherId());if(n){var a=n.getChildren();null==a&&(a=[],n.setChildren(a)),a.push(e)}})),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),I=r("3a34"),E=r.n(I),L=function(){function e(){Object(l["a"])(this,e)}return Object(h["a"])(e,null,[{key:"getVConsole",value:function(){return null==e.console&&(e.console=new E.a),e.console}}]),e}(),B=n["a"].extend({name:"App",components:{CherryReader:C},data:function(){return{isShowDebug:!1,errorMsg:"",isShowErrorMsg:!1,isShowInputDialog:!1,isLoading:!1,remoteUrl:"",txt:"<empty>",showNav:!0,cherrytree:new N}},methods:{onDebugSwitch:function(){this.isShowDebug?L.getVConsole().showSwitch():L.getVConsole().hideSwitch()},onUploadFile:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.name.endsWith("ctb")){r.next=3;break}return t.showErrorMsg("please upload a .ctb file"),r.abrupt("return");case 3:t.parseCtbFile(e);case 4:case"end":return r.stop()}}),r)})))()},loadFromUrl:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.isShowInputDialog=!1,e.isLoading=!0,console.log("try load:"+e.remoteUrl);try{r=new XMLHttpRequest,r.open("GET",e.remoteUrl,!0),r.responseType="arraybuffer",r.onload=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(n),t.prev=1,a=new Uint8Array(r.response),o=new R(new Uint8Array(a)),t.next=6,e.cherrytree.init(o);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.showErrorMsg("load file fail:"+t.t0);case 11:e.isLoading=!1,e.showNav=!0;case 13:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}(),r.onerror=function(t){console.log("load error",t),e.showErrorMsg("load fail!"),e.isLoading=!1},r.send()}catch(n){e.isLoading=!1,console.log(n)}case 4:case"end":return t.stop()}}),t)})))()},parseCtbFile:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(void 0!=e.arrayBuffer){r.next=3;break}return t.showErrorMsg("Current brower not support arrayBuffer() function,please try another!"),r.abrupt("return");case 3:return console.log("upload file:",e),r.t0=R,r.t1=Uint8Array,r.next=8,e.arrayBuffer();case 8:return r.t2=r.sent,r.t3=new r.t1(r.t2),n=new r.t0(r.t3),r.next=13,t.cherrytree.init(n);case 13:t.showNav=!0;case 14:case"end":return r.stop()}}),r)})))()},toTreeData:function(e){var t,r={id:e.getNodeId(),name:e.getName(),children:[]},n=[],a=Object(i["a"])(e.getChildren());try{for(a.s();!(t=a.n()).done;){var o=t.value,c=this.toTreeData(o);n.push(c)}}catch(s){a.e(s)}finally{a.f()}return r.children=n,r},onClickNav:function(e){if(0!=e.length){var t=e[0],r=this.cherrytree.getNodeTxtById(t);this.txt=r}},showErrorMsg:function(e){this.errorMsg=e,this.isShowErrorMsg=!0}},computed:{getCurrentNavTree:function(){var e=[];if(null==this.cherrytree)return e;var t,r=Object(i["a"])(this.cherrytree.getNodes());try{for(r.s();!(t=r.n()).done;){var n=t.value;e.push(this.toTreeData(n))}}catch(a){r.e(a)}finally{r.f()}return e}}}),F=B,U=r("6544"),A=r.n(U),P=r("7496"),q=r("40dc"),$=r("5bc1"),H=r("8336"),J=r("b0af"),Q=r("99d9"),G=r("169a"),W=r("ce7e"),X=r("23a7"),z=r("132d"),K=r("f6c4"),Y=r("f774"),Z=r("a797"),ee=r("490a"),te=r("2db4"),re=r("2fa4"),ne=r("b73d"),ae=r("8654"),oe=r("eb2a"),ie=Object(m["a"])(F,a,o,!1,null,null,null),ce=ie.exports;A()(ie,{VApp:P["a"],VAppBar:q["a"],VAppBarNavIcon:$["a"],VBtn:H["a"],VCard:J["a"],VCardActions:Q["a"],VCardText:Q["b"],VDialog:G["a"],VDivider:W["a"],VFileInput:X["a"],VIcon:z["a"],VMain:K["a"],VNavigationDrawer:Y["a"],VOverlay:Z["a"],VProgressCircular:ee["a"],VSnackbar:te["a"],VSpacer:re["a"],VSwitch:ne["a"],VTextField:ae["a"],VTreeview:oe["a"]});var se=r("f309");n["a"].use(se["a"]);var ue=new se["a"]({});n["a"].config.productionTip=!1,V.initSql(),new n["a"]({vuetify:ue,render:function(e){return e(ce)}}).$mount("#app")},f498:function(e,t,r){"use strict";r("a9a1")}});
//# sourceMappingURL=app.8f413768.js.map